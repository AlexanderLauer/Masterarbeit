\subsection{potentially minimal improving rules}


\begin{definition}[\textbf{non-consistency decreasing rule}]
Let a plain rule $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ and a constraint $c$ in EANF be given. 
Then, $\rho$ is called a \emph{non-consistency decreasing rule  w.r.t $c$ at layer $k$} if 
\begin{enumerate}
\item If $C_k$ is universally bound and for all transformations $t: G \Longrightarrow_{\rho} H$ it holds that 
$$\forall p: C_k \inj H: \exists p':C_k \inj G: \track_t \circ p' = p.$$

\item If $C_k$ is existentially bound for all transformations $t: G \Longrightarrow_{\rho} H$ it holds that 
$$\forall p: C_k \inj G: \track_t \circ \text{ p is total}.$$
\end{enumerate}
The rule $\rho$ is called \emph{non-consistency decreasing w.r.t $c$ up to layer $k$} if $\rho$ is non-consistency decreasing w.r.t $c$ at layer $j$ for all $1 \leq j \leq k$.
\end{definition}

\begin{corollary}
Let a graph $G$, a constraint $c$ in EANF and a non-consistency decreasing rule w.r.t $c$ up to layer $\maxc{G}$ be given. 
Then, for each transformation $t: G \Longrightarrow_{\rho} H$ it holds that 
$$\maxc{G} \leq \maxc{H}.$$
\end{corollary}

\begin{lemma}\label{def:non-decreasing}
Let a plain rule $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ and a constraint $c$ in EANF be given. 
Then, $\rho$ is a non-consistency decreasing rule at layer $k$ w.r.t $c$ if either \ref{category:non-decreasing_1}. or \ref{category:non-decreasing_2}. applies.  


\begin{enumerate}
\item \label{category:non-decreasing_1}
If $C_k$ is universally bound, let $I$ be the set of all isolated nodes of $C_k$, $P$ be the set of all partial morphisms $p: C_k \inj R$, 
$$E = \bigcup_{p \in P} p(E_{C_k}) \cap (E_R \setminus E_K) \text{ and }  V = \bigcup_{p \in P} p(V_{C_k}) \cap (V_R \setminus V_K).$$
Then, $\rho$ is called a \emph{non-consistency decreasing rule at layer $k$ w.r.t $c$} if 
$I \cap V = \emptyset$ and
\begin{alignat*}{2}
	&\big(\neg \exists e \in E: \exists v,v' \in V_K: \src(e) = r(v) \wedge \tar(e) = r(v')\big) & \wedge \\
	&\big(\forall v \in V: \exists e \in E_{C_k}: \exists p \in P: \src(e) = p^{-1}(v) \vee \tar(e) = p^{-1}(v) \\ &\wedge \neg \exists e' \in E: \exists p \in P: p^{-1}(e')=e\big)
\end{alignat*}
holds.


\item \label{category:non-decreasing_2}
If $C_k$ is existentially bound, let $I$ be the set of all isolated nodes of $C_k$, $P$ be the set of al morphisms $p:C_k \inj L$, 
$$E = \bigcup_{p \in P} p(E_{C_k}) \cap (E_L \setminus E_K) \text{ and }V = \bigcup_{p \in P} p(V_{C_k}) \cap (V_L \setminus V_K).$$  

\end{enumerate}
Let $I$ be the set of all isolated nodes of $C_k$. Then, $\rho$ is called a \emph{non-consistency decreasing rule at layer $k$ w.r.t $c$} if $I \cap V = \emptyset$ and 
\begin{alignat*}{2}
	&\big(\neg \exists e \in E_{C_k}\setminus E_{C_{k-1}}: \exists p \in P: \exists e' \in E: p(e) = e'\big) &\wedge  \\
	&\big(\forall v \in V: \exists e \in E_{C_k}: \exists p \in P: \src(e) = p^{-1}(v) \vee \tar(e) = p^{-1}(v) \\ &\wedge \neg \exists e' \in E: \exists p \in P: p^{-1}(e')=e\big)
\end{alignat*}
\end{lemma}
\begin{proof}

\end{proof}



\begin{definition}[\textbf{basic increasing rule}]
Let a constraint $c$ and a plain rule $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ be given. 
Then, $\rho$ is called a \emph{basic increasing w.r.t $c$ at layer $k$} if $\rho$ is a non-consistency decreasing w.r.t $c$ up to layer $k$ and

\begin{enumerate}
\item If $C_k$ is universally bound: 
	There does exist a morphism $i: L \inj C_k$ and 
	$$\exists e \in C_k\setminus C_{k-1}: \neg \exists e' \in K: i(e) = l(e).$$
	Then, $\rho$ is called a \emph{deleting basic increasing rule}.
\item If $C_k$ is existentially bound:
	There does exist a morphism $i: C_{k-1} \inj L$ such that $i \not \models \exists (a_k^p: C_{k-1} \inj C', \true)$ and $\	r \circ l^{-1} \circ i \models \exists(a_k^p:C_{k-1} \inj C', \true)$ for any $C'\in \mathcal{U}(C_{k-1}, C_{k})$, let the sets $E$ and $V$ be constructed as introduced in lemma \ref{def:non-decreasing} it holds that
	\begin{alignat*}{2}
		\forall v \in V: \exists v' \in V_K: l(v') = v &\wedge \\
		\forall e \in E: \exists e' \in E_K: l(e') = e
	\end{alignat*}
	Then, $\rho$ is called an \emph{inserting basic increasing rule} and $i$ is called the increasing morphism of $\rho$.
\end{enumerate}

\end{definition}




\begin{definition}[\textbf{application conditions for basic increasing rules}]
Let a constraint $c$ in EANF and a basic increasing rule  $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ w.r.t $c$ at layer $k$  with $C \in \mathcal{U}(C_k, C_{k+1}$ be given. 
We define the application condition for $\rho$ as:
 
\begin{enumerate}
\item If $\rho$ is a deleting increasing rule:
$$\api(j, P) := \begin{cases}
				\bigvee_{P \in \overlay(L,C_k)} \bigwedge_{P' \in \eol(P, a_k)} \exists(i_L^P: L \inj P, \neg \exists(i_P^{P'}: P \inj P', \true)) &\text{, if j = k} \\
				\false &\text{, if } j \neq k.
				\end{cases}$$
\item If $\rho$ is an inserting increasing rule. Let $a^p:C_k \inj C$ be a partial morphism of $a_k$ , $e: C_k \inj L$ be the increasing morphism of $c$ and $Q$ be set of all overlaps $P$ of $L$ and $C$ such that $i_L^P \circ e \models \exists(a^p:C_k \inj C, \true)$:				
$$\api(j, P) := \begin{cases}
				\bigvee_{P \in Q} \exists(i_L^P: L \inj P, \true) &\text{, if j = k}\\
				\false	&\text{, if } j \neq k
				\end{cases}$$


\end{enumerate}



\end{definition}

\begin{theorem}\label{api_direct_proof}
Let a graph $G$, a constraint $c$ in EANF, with $G \models \parcond(\maxc{G}, c, C)$ and $\parcond(\maxc{G}, c, C) \in \mathcal{P}_c^G$, and a potentially minimal improving rule $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ at layer $\maxc{G}$ with $C_{\cmax+1}\subseteq P \subseteq C_{\cmax+2}$ be given. 
Then, $\rho' = (\rho, \api(\maxc{G}+1,P))$ is a direct minimal consistency improving rule. 
\end{theorem}
\begin{proof}
Let $t:G \Longrightarrow_{\rho',m} H$ be a transformation, $k = \maxc{G}+1$ and $e$ be the subcondition of $c$ at layer $k$. 
We show that $t$ is a direct minimal consistency improving transformation.
First, we show that equation (\ref{direct_improving_1}) is satisfied.
Let $p: C_{k} \inj G$ be a morphism. 
If $\rho$ is a deleting potentially minimal improving rule, either \ref{proof_api_1}. or  \ref{proof_api_2}. applies, if $\rho$ is an inserting and not a deleting potentially  minimal improving rule, only \ref{proof_api_2}. applies, because $\rho$ cannot destroy any occurrences of $C_k$ in $G$. 
\begin{enumerate}
	\item\label{proof_api_1} If $p(C_k) \cap m(L\setminus K) \neq \emptyset$, $\track_t \circ p$ is not total, since at least one element of $p(C_k)$ has been deleted by $t$ and $p$ does satisfy $\bigwedge_{C' \in \mathcal{U}(C_k, C_{k+1})}(p \models \parcond(1,e,C') \wedge \track_t \circ p \text{ is total}) \implies \track_t \circ p \models \parcond(1,e,C'))$. 
	\item\label{proof_api_2} If $p(C_k) \cap m(L\setminus K) = \emptyset$, $\track_t \circ p$ is total, since no element of $p(C_k)$ has been deleted by $t$.  
	Because (\ref{pot_1}) holds, $t$ does not delete any elements of $C_{k+1}\setminus C_k$ and $p \models \parcond(1,e,C') \implies \track_t \circ p \models \parcond(1,e,C')$ for all $C' \in \mathcal(U) (C_k, C_{k+1})$.
\end{enumerate} 
With \ref{proof_api_1}. and  \ref{proof_api_2}. follows that (\ref{direct_improving_1}) is satisfied. 

Second, we show that equation (\ref{direct_improving_1_2}) is satisfied.
Let $p':C_k \inj H$ be a morphism. 
Because (\ref{pot_2}) is satisfied, $t$ does not create any elements of $C_k$ and there must exist a morphism $p : C_k \inj G$ with $\track_t \circ p = p'$. If follows that (\ref{direct_improving_1_2}) is satisfied. 

Third, we show that (\ref{direct_improving_2}) is satisfied. 
We consider the cases that firstly, $\rho$ is a deleting minimal potentially improving rule and secondly, that $\rho$ is an inserting and not a deleting minimal potentially improving rule. 

\begin{enumerate}
\item If $\rho$ is a deleting potentially minimal improving rule, the condition $\api(k,P) = \exists\bigl(b: L \inj C_{k}, \neg \exists(a_{k+2}:C_{k} \inj C_{k+1}, \true)\bigr)$ is satisfied by $m$. 
Therefore a morphism $p :C_k \inj G$ with $p \not \models \neg \exists(a_{k+1}:C_k \inj C_{k+1}, \true) = \parcond(1,e,C_{k+1})$ and $m = p \circ b$ must exist. 
Since $\rho$ is a deleting rule, at least one element of $p(C_k)$ has been deleted by $t$ and $\track_t \circ p$ is not total. 
It follows that (\ref{direct_improving_2}) is satisfied. 

\item 
If $\rho$ is an inserting and not a deleting potentially minimal improving rule, $\api(k,P) = \neg \exists(b: L \inj P, \true)$ is satisfied by $m$. 
Because $L = C_k$, $m \models \neg \exists(b: C_k \inj P, \true) = \parcond(1,e,P)$.
Since (\ref{pot_ins}) is satisfied, $\track \circ p$ is total and $\track_t \circ p \models \parcond(1,e,P)$. Therefore, (\ref{direct_improving_2}) is satisfied. 

\end{enumerate}

Last, since (\ref{pot_2}) and (\ref{pot_1}) are satisfied, $\rho$ cannot create any occurrence of $C_j$ with $j \leq k$ and $j$ being even and $\rho$ cannot delete any occurrences of $C_j$ with $j \leq k$ and $j$ being odd. 
Therefore, (\ref{direct_improving_3}) and (\ref{direct_improving_4}) are satisfied. 


In total follows that $t$ is a direct minimal consistency improving transformation and $\rho'$ is a direct minimal consistency improving rule. 
\end{proof}

\begin{theorem}
Let a constraint $c$ in EANF, a basic increasing rule $\rho$ with $P$ and a consistency increasing transformation $t: G \Longrightarrow_{\rho,m} H$ w.r.t $c$ be given. 
Then, $m \models \api(\maxc{G}, P)$.
\end{theorem}
\begin{proof}
Let $k = \maxc{G}$.
\begin{enumerate}
\item If $c$ is a inserting rule, then $\api(\maxc{G}, P) = \neg \exists(a^p_k: L \inj P, \true)$. Let $n : R \inj H$ be the comatch of $t$. 
Since $t$ is a consistency increasing transformation, there does exist a morphism $p : C_k \inj G$ with $p \not \models \exists(a^p_k: C_k \inj P, \true)$, $\track_t \circ p \models\exists(a^p_k: C_k \inj P, \true)$ such that $p'(P) \cap n(R\setminus K)$ for the morphism $p': P \inj H$ with $p = p \circ a^p_k$.
Assume that $m \models \exists(a^p_k: L \inj P, \true)$.  
Then, every morphism $p: C_k \inj G$ with $\track_t \circ p \models \exists(a^p_k: C_k \inj P, \true)$ with $p'(P) \cap n(R\setminus K)$ for the morphism $p': P \inj H$ with $p = p' \circ a^p_k$ already satisfies $\exists(a^p_k: C_k \inj P, \true)$. This is a contradiction.

\item If $\rho$ is a deleting rule, $\api(k, P) = \bigvee_{P \in \overlay(L,C_k)} \bigwedge_{P' \in \eol(P, a_k)} \exists(i_L: L \inj P, \neg \exists(i_P: P \inj P', \true))$.
Since $t$ is a consistency increasing transformation, there does exist a morphism $p :C_k \inj G$, such that $p \not \models \exists(a_k: C_k \inj C_{k+1}, \true)$ and $\track_t \circ p$ is not total. 
Assume that $m \not \models \api(k,P)$. 
Then, for each overlap $Q$ of $L$ and $C_k$, the inclusion $i_{C_k}$ does satisfy $\exists(a_k: C_k \inj C_{k+1}, \true)$.
This is a contradiction, because $p(C_k) \cap m(L\setminus K) \neq \emptyset$ has to hold.
\end{enumerate}

\end{proof}

\begin{lemma}
	Let a constraint $c$ in EANF and inserting basic increasing rules $\rho_1$, $\rho_2$ at layer $k$ with $P_1$ and $P_2$, respectively, be given. 
	Then, the rules $\rho'_1 = (\rho_1, \api(k,P_1))$ and $\rho'_2 = (\rho_2, \api(k,P_2))$
	are sequentially independent. 
\end{lemma}
\begin{proof}
Let $G_1 \Longrightarrow_{\rho'_1, m_1} G_2\Longrightarrow_{\rho'_2, m_2}G_3$ be a sequence of transformations. 
First, note that this sequnce can only exist if $P_1 \not \subseteq P_2$ and $P_2 \not \subseteq P_1$
Since both rules are do not insert elements of $C_k$, a morphism $d_1: L_2 \inj D_1$ with $m_2 = h_1 \circ d_1$ exists. 
Because both rules do not delete any elements a morphism $d_2: R_1 \inj D_2$ with $m^*_1 = g_2 \circ d_2$ exists. 
Because $\rho_2$ is not a basic increasing rule with $P_1$, $h_2 \circ d_2 \models R(\api)$ and because $\rho_1$ does not delete any elements of $P_2$ is holds that $g_1 \circ d_1 \models R(\api)$.
\end{proof}

\begin{definition}[\textbf{repairing rule set}]
Let a constraint $c$ in EANF and a set of rules $\mathcal{R}$ be given. 
Then, $\mathcal{R}$ is called a \emph{repairing rule set for $c$ at layer $k$}  if for all graphs $G$ with $k = \cmax$ a sequence 
$$G = G_0 \Rightarrow_{r_0} \ldots \Rightarrow_{r_{n-1}} G_n = H$$
exists, such that $r_j \in \mathcal{R}$ for all $j \in \{0,\ldots, n-1\}$ and $H \models_{k+2} c$. 

\end{definition}


\begin{corollary}
	Let a constraint $c$ in EANF and a repairing rule set $\mathcal{R}$ for $c$ at layer $k$, for all $k\in \{1,3,\ldots, \nlvl(c)\}$, be given. 
	Then, for all graphs $G$, a sequence
	$$G = G_0 \Rightarrow_{r_0} \ldots \Rightarrow_{r_{n-1}} G_n = H$$
	exists, such that $r_j \in \mathcal{R}$ for all $j \in \{0, \ldots, n-1\}$ and $H \models c$. 
\end{corollary}




\begin{definition}[\textbf{decomposition of a graph}]
Let graphs $G_0 \subset G_1$ be given. 

A decomposition of $G_1$ with $G_0$ is a minimal set 
 $$\mathbf{P} \subseteq \{P_v \mid v \in V_{C_1 \setminus C_0} \}$$ of subgraphs of $G_1$, such that every element of $G_1$ is contained in at least one $P \in \mathbf{P}$  and  every $P_v$ is constructed in the following way:
$G_0 \subset P_v$, $v \in P$ and for all nodes $v' \in P \setminus C_k$ is holds that $P$ contains all edges $e \in E_{G_1 \setminus G_0}$ and all nodes $u \in V_{G_1}$ such that  either $\tar(e) = v' \wedge \src(e) = u$ or  $\src(e) = u \wedge \tar(e) = v'$ holds. 
\end{definition}

\begin{lemma}\label{decomp_sets_lemma}
Let graphs $G_0 \subset G_1$ and a decomposition $\mathbf{P}$ of $G_1$ with $G_0$ be given. 
Then, for each pair $P, P' \in \mathbf{P}$ with $P \neq P'$ the following holds:
$$(P\setminus C_k)\cap (P' \setminus C_k) = \emptyset$$
\end{lemma}

\begin{proof}
 Assume that $(P\setminus C_k)\cap (P' \setminus C_k) \neq \emptyset$, therefore a node $v \in G_1 \setminus G_0$ with $v \in P \cap P'$ exists. 
 By the construction of $P$ and $P'$ it follows that $P = P_v$ and $P' = P_v$ and therefore $P = P'$. 
This is a contradiction.
\end{proof}

\begin{lemma}
Let graphs $G_0 \subset G_1$ and a decomposition $\mathbf{P}$ of $G_1$ with $G_0$ be given. 
Then, $$ G_1 = \bigcup_{P \in \mathbf{P}} P.$$ 

\end{lemma}

\begin{proof}
Let $H := \bigcup_{P \in \mathbf{P}} P$.
Firstly, we show that $H \subseteq G_1$.
Since every $P \in \mathbf{P}$ is a subgraph of $G_1$ it follows that $V_H \subseteq V_{G_1}$ and $E_H \subseteq E_{G_1}$

Secondly, we show that $G_1 \subseteq H$.
Let $u \in V_{G_1}$ be a node, if $u \in V_{G_0}$, then $u$ is contained in every $P \in \mathbf{P}$ and therefore $u \in V_H$. 
Otherwise, if $u \not \in V_{G_0}$, then $u$ has to be, by the definition of $\mathbf{P}$, contained in at least one $P \in \mathbf{P}$ and  $V_{G_1} \subseteq V_H$ follows. 
Let $e \in E_{G_1}$ be an edge. 
If $e \in E_{G_0}$, then $e$ is contained in every $P \in \mathbf{P}$ and $e \in E_H$. 
Otherwise, if $e \not  \in E_{G_0}$, by the definition of $\mathbf{P}$, $e$ has to be contained in at least one $P \in \mathbf{P}$. 
It follows that $e \in E_H$ and with that $E_{G_1} \subseteq E_H$. 
\end{proof}



\begin{theorem}\label{caracter_rep_rule_set_at_layer}
Let a constraint $c$ in EANF and a set of rules $\mathcal{R}$   be given. 
Then, $\mathcal{R}$ is a repairing set of $c$ at layer $k \leq \nlvl(c)$ if either \ref{cat_rep_set_1} or \ref{cat_rep_set_2} applies. 

\begin{enumerate}
	\item \label{cat_rep_set_1}
	 For any universally bound graph $C_j$ at layer $j \leq k$ of $c$, $(\rho, \api(j, C_{j+1})) \in \mathcal{R}$ and $\rho$ is a deleting potentially minimal improving rule at layer $j$ with $C_{j+1}$, such that $\rho$ only deletes edges of $C_j$.
	\item \label{cat_rep_set_2}
	A decomposition $\mathbf{P}$ of $C_k$ with $C_{k-1}$ exists, such that for each $P \in \mathbf{P}$ a rule $(\rho, \api(k,P)) \in \mathcal{R}$ exists, such that $\rho$ is an inserting basic improving rule at layer $k$ with $P$.
	
	\item \label{cat_rep_set_3}
		There does exist a sequence of graphs 
			$$C_k = C'_0 \inj C'_1 \inj \ldots \inj C'_n = C_{k+1}$$
		such that a inserting basic increasing rule $\rho_i  = L_i \xhookleftarrow{l_i} K_i \xhookrightarrow{r_i} R_i$ at layer $k$ with $C_i$ exists such that $L_i \inj R_{i-1}$ and $e_i = i_{C{i-1}}^{C_i} \circ e_{i-1}$ with $e_i$ being the increasing morphism of $\rho_i$ for all $i \in \{1, \ldots n\}$.
\end{enumerate}
\end{theorem}

\begin{proof}
Let a constraint $c$ in EANF, a rule set $\mathcal{R}$ and a graph $G$ with $k = \cmax$ and $\cmax < \nlvl(c)$ be given. 
We show that a sequence $G = C_0' \Rightarrow \ldots \Rightarrow C_n' = H$ with rules of $\mathcal{R}$ exists, such that $H \models_{k+2} c$ if \ref{cat_rep_set_1}. or \ref{cat_rep_set_2}.  of theorem \ref{caracter_rep_rule_set_at_layer} is satisfied.
\begin{enumerate}
\item
 Assume that \ref{cat_rep_set_1}. of theorem \ref{caracter_rep_rule_set_at_layer} holds. Let $(\rho, \api(j, C_{j+1})) \in \mathcal{R}$, such that $\rho = L \xhookleftarrow{l} K \xhookrightarrow{r} R$ is a deleting potentially minimal improving rule at layer $j \leq k$ with $C_{j+1}$ and $C_j$ is a universally bound graph of $c$.
Then, $\api(j, C_{j+1}) = \exists\bigl(b: L \inj C_{j}, \neg \exists(a_j:C_{j} \inj C_{j+1}, \true)\bigr)$.
Let $q: C_j \inj G$ be a morphism such that  $q \not \models \exists(a_j: C_j \inj C_{j+1}, \true)$.
Since $L \subseteq C_j$, we can construct a morphism $m_1: L \inj G$ with $m_1 = q \circ b$ and therefore $m_1 \models \api(j,C_{j+1})$.
Since $r$ only deletes edges, a transformation $t: G = G_0 \Rightarrow_{r,m_1} G_1$ exists and $\track_t \circ p$ is not total. 
Because $r$ does not insert any elements of $C_j$: 
$$|\{q: C_k \inj G_0 \mid  q \not \models  d\}| < |\{q: C_k \inj G_1 \mid  q \not \models  d\}|$$
with $d = \exists(a_j: C_j \inj C_{j+1}, \true)$.
By iteratively applying this construction, we can generate a finite sequence of transformations
$$G = G_0 \Rightarrow_{r, m_1} G_1 \Rightarrow_{r, m_2} \ldots \Rightarrow_{r,m_n} G_n = H$$
such that $|\{q: C_k \inj G_n \mid  q \not \models  d\}| = 0$ and therefore $H \models_j c$. 
With lemma \ref{lemma_lay_sat}, $H \models_{k+2} c$ and $H \models c$ follows. 

\item 
Assume that \ref{cat_rep_set_2}. of theorem \ref{caracter_rep_rule_set_at_layer} holds. 
Let $\rho_0 = (\rho, \api(k,P)) \in \mathcal{R}$, such that $\rho$ is an inserting basic improving rule of $c$ at layer $k$ with $P \in \mathbf{P}$. 
Then, $\api(k, P) = \neg \exists(b: L \inj P, \true)$.
Let $q_0 : C_k \inj G$ be a morphism, such that $q_0 \not \models \exists(a'_k: C_k \inj P, \true)$ with $a'_k$ being a partial morphism of $a_k$.
Since $L = C_k$, we set $m_0: C_k \inj G$ with $m_0 = q_0$. 
It follows that $m_0 \models \neg \exists(a'_k: C_k \inj P, \true) = \api(k,P)$.
Because $r$ does not delete any elements, a transformation $t_0: G \Longrightarrow_{r_0,m_0} G_1$ exists and $\track_t \circ q \models \exists(a'_k: C_k \inj P, \true)$.  
We set $q_1 = \track_{t_0} \circ q_0$ and apply the same method to $q_1$. 

By iteratively applying this, we can construct a finite sequence of transformations 
$$G \Longrightarrow_{r_0, m_0} G_0 \Longrightarrow_{r_1,m_1} \ldots \Longrightarrow_{r_n,m_n} G_n$$ 
such that $m_i = \track_{t_{i-1}} \circ \ldots \circ \track_{t_0} \circ m_0$ and $q\models \exists(b_i: C_k \inj P_i, \true)$ for all $P_i \in \mathbf{P}$ with $q = \track_{t_n} \circ q_n$.
Let $p_i: P_i \inj G_n$ be the morphism, such that  $q = p_i \circ b_i$. 

Now, we can construct a morphism $p: C_{k+1} \inj G$ with 
$$ p(e) := \begin{cases}
			p_1(e) &\text{,if } e \in P_1\\
			&\vdots\\
			p_j(e) &\text{,if } e \in P_j.
		\end{cases}$$
		
Let $e \in C_k$, because $q(e) = p_i \circ b_i(e)$ and $q(e) = p_{\ell} \circ b_{\ell}(e)$ and $b_i$ and $b_{\ell}$ are both partial morphisms of $a_k$, it follows that $b_i(e) = b_{\ell} (e)$ and therfore $p_i (e) = p_{\ell} (e)$. 
Because $(P_i \cap P_{\ell})\setminus C_k = \emptyset$ for all $i \neq \ell$, $p$ is a morphism and by the definition of $p$ it follows that 
$q = p \circ a_k$ and therefore $q \models \exists(a_k: C_k \inj C_{k+1}, \true)$.

By iteratively applying this whole construction to all occurrences of $C_k$ that do not satisfy $\exists(a_k:C_k \inj C_{k+1},\true)$ the derived graph graph $H$ does not contain any occurrences of $C_k$ not satisfying $\exists(a_k: C_k \inj C_{k+1},\true)$ and therefore  $H \models_{k+2} c$. 

\end{enumerate}
\end{proof}
\begin{corollary}
If a set of rule $\mathcal{R}$ is a repairing set of $c$ at layer $k \leq \nlvl(c)$ and \ref{cat_rep_set_1}. of theorem \ref{caracter_rep_rule_set_at_layer} applies, then $\mathcal{R}$ is a repairing set of $c$ at layer $j$ for all $k \leq j \leq \nlvl(c)$. 
\end{corollary}

\begin{lemma}
Let a graph $G_0$, a constraint $c$ in EANF and a repairing set $\mathcal{R}$ at layer $\maxc{G_0}  +1$ be given, such that each rule in $ \mathcal{R}$ is a basic increasing.
Then, for every sequence
$$G_0 \Longrightarrow_{\rho_0, m_0} G_1 \Longrightarrow_{\rho, m_0} \ldots \Longrightarrow_{\rho_n, m_n} G_n$$
such that $\rho_i = (\rho, \api(\maxc{G_0} + 1, P)$ with $\rho \in \mathcal{R}$ being a consistency increasing rule at layer $\maxc{G_0} + 1$ with $P$, it holds that 

\end{lemma}

\begin{figure}
\centering
\begin{algorithm}[H]
	%\DontPrintSemicolon
	\KwData{A graph $G$, a constraint $c$ in EANF  and a set of rules $\mathcal{R}$}
	\KwResult{A graph $H$ with $H \models c$}
	extract basic rules of $\mathcal{R}$\;
	\uIf{$\mathcal{R}$ is a repairing set}{
		repair
	}
	\Else{
		repair with basic rules + application condition\;
		repair with normal rules + application condition\;
		generate a basic increasing rule set $\mathcal{R}'$\;
		repair with rules of $\mathcal{R}'$ \;
	}


\caption{ Floyd-Warshall Algorithmus}\label{Algo_floyd}

\end{algorithm}
\end{figure}

\input{figures/consistency_relations_basic_rules.tex}


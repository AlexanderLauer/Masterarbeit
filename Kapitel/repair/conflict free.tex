\subsection{Rule-based Graph Repair for one Constraint}

In the following, we present our graph repair process for a circular conflict free constraint in UANF. 


\input{Algorithms/conflict_free_repair_repairing_set}


\begin{theorem}
	Let a graph $G$, a circular conflict free condition in UANF and 
	a repairing set $\mathcal{R}$ be given. 
	Then, Algorithm \ref{Algo_conflict_free} with input $G$,$c$ and $\mathcal{R}$ 
	terminates and returns a graph $H$ with $H \models c$.
\end{theorem}
\begin{proof}
	If Algorithm \ref{Algo_conflict_free} terminates, it returns a graph 
	satisfying $c$. Therefore, it is sufficient to show that Algorithm 
	\ref{Algo_conflict_free} will terminate.
	Since $G$ is finite, the set $P$ must also be finite.
	If a repairing sequence has been applied, the set 
	$M$ only contains occurrences of graphs $C_j$ such that 
	$C_{\kmax +2}$ has a (transitive) conflict with $C_j$ since the 
	repairing sequence is not able to destroy or insert occurrences 
	of $C_i$ such that $C_{\kmax +2}$ has no (transitive) conflict with $C_i$.
	Because $G$ is finite, $|M|$ must also be finite.
	
	If the derived graph does not satisfy $\cut{\maxk{c}{G}}{c}$, we need 
	to restore the satisfaction at layer. 
	Because the satisfaction at layer only decreases if an occurrence of an 
	existentially bound graph has been destroyed or an occurrence of 
	universally bound graphs has been inserted and $M$ does contain all these 
	occurrences, we only need to consider the occurrences contained in $M$. 
	The application of repairing sequences at occurrences $p :C_j \inj H \in M$
	could again lead to an insertion of universally bound or an removal 
	of existentially bound graphs. The set $M'$ contains all these 
	occurrences 
	and again, this are only occurrences of $C_i$ such that $C_j$ has a 
	(transitive) conflict with $C_i$.
	Since $c$ is circular conflict free, $M'$ cannot contain any occurrences 
	of $C_{\kmax +2}$, otherwise, $C_j$ would have a (transitive) conflict with 
	$C_{\kmax +2}$ and therefore $C_{\kmax +2}$ has circular conflict. Therefore 
	no occurrences of $C_{\kmax +3}$ will be destroyed an no occurrences 
	of $C_{\kmax+2}$ will be inserted.
	Additionally, $C_{\kmax +2}$ has a (transitive) conflict with $C_i$ and 
	the repair of any $p \in M'$ will not lead to an insertion of an occurrence 
	of 	$C_{\kmax +2}$ or the removal of an occurrence of $C_{\kmax +3}$.
	
	Since $c$ is circular conflict free, there must exist graphs $C_i$, such that 
	$C_i$ has no conflict with any other graph 
	$C_{i'}$ and $C_{\kmax+2}$ has a (transifitve= conflict with $C_i$. 
	Therefore, the application of repairing sequences at occurrences 
	of these graphs will not lead to the insertion or removal of any universally 
	or existentially bound graph, respectively.
	Since $c$ is finite, the number of graphs $C_i$ 
	such that $C_{\kmax+2}$ has a (transitive) conflict with $C_i$ is finite.
	Since $|M'|$ is also finite, after a finite number of repairing sequence 
	applications, $M'$ only contains occurrences of graphs 
	that do not have any conflicts. After a repairing sequence has been 
	applied at all those occurrences, $M'$ is empty and
	$H \models_{\maxk{c}{G}} c$, since all occurrence $p$ of $C_j$, that either 
	have 
	been inserted or an occurrence $q$ of $C_{j+1}$ with $p = a_j \circ 
	q$ has been removed, satisfy $\exists (C_{j+1},\true)$. 
	Additionally holds that $\nv{\kmax +1}{H} < \nv{\kmax +1}{G}$.
	
	Therefore, after a finite number of iterations, the satisfaction at layer 
	has been increased by at least $1$. 
	It follows that after a finite number of iterations $G \models c$. 
	Then, Algorithm \ref{Algo_conflict_free} terminates and returns $G$.
\end{proof}
